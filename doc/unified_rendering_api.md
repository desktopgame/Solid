# 統一された描画API
多様なシェーダーを扱うにあたり、[静的リフレクション](./static_reflection.md)もひとつの有効な手段ですが、  
コードの重複を排除するには、これに加えて可能な限り描画APIを共通化することも求められます。  

# 課題
ディスクリプタヒープの管理は、描画APIを共通化するうえで最も煩雑な部分です。  
シェーダーごとに異なるレイアウトを手動で合わせ込む必要があり、  
素朴に実装すると「CBV/SRV/UAVの登録」「スロット番号の定義」といった
大量のボイラープレートコードが発生します。

# 解決方法
幸い、このプロジェクトでは静的リフレクションを導入しているので、  
その仕組みに乗っかることでかなり楽できます。  

メタファイルに記述されたレイアウトからC++のユニフォームレイアウト定義を出力し、  
これに沿ってディスクリプタヒープを確保するだけです。
このあたりの制御を行っているのが UniformBuffer です。  
内部的には一本のバッファに VS, GS, PS, CS の順でデータが並んでいます。  
内部で適切にオフセットしてくれるので、単にシェーダーステージとユニフォームの番号を指定するだけでどんなシェーダーでも同じ方法でユニフォームをセットできます。

また、ディスクリプタヒープそれぞれが独立したバッファを保持するわけではありません。  
初期化時に一本の長いバッファを生成し、それぞれのディスクリプタヒープが範囲が被らないようにバッファを使っていきます。